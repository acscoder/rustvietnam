<!DOCTYPE html><html lang="vi"><head><title>Quản lý Sessions - RustVietnam</title><meta charset="UTF-8"/><link rel="profile" href="http://gmpg.org/xfn/11"/><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta http-equiv="Cache-control" content="public"/><meta http-equiv="Cache-control" content="max-age=604800"/><meta http-equiv="Cache-control" content="Content-Encoding=gzip"/><link rel='icon' type='image/x-icon' href='https://rustvietnam.com/wp-content/themes/onda/images/favicon.svg' /><link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet"/> <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/0.6.7/js/min/perfect-scrollbar.jquery.min.js"></script> <link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet" /><meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' /><link rel="canonical" href="https://rustvietnam.com/lap-trinh-web-voi-rust/quan-li-sessions/" /><meta property="og:locale" content="en_US" /><meta property="og:type" content="article" /><meta property="og:title" content="Quản lý Sessions - RustVietnam" /><meta property="og:description" content="Session là thông tin về phiên làm việc cho từng khách truy cập" /><meta property="og:url" content="https://rustvietnam.com/lap-trinh-web-voi-rust/quan-li-sessions/" /><meta property="og:site_name" content="RustVietnam" /><meta property="article:published_time" content="2021-09-27T07:31:30+00:00" /><meta property="article:modified_time" content="2021-12-05T15:12:22+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:label1" content="Written by" /><meta name="twitter:data1" content="admin" /><meta name="twitter:label2" content="Est. reading time" /><meta name="twitter:data2" content="3 minutes" /> <script type="application/ld+json" class="yoast-schema-graph">{
	    "@context": "https://schema.org",
	    "@graph": [
	        {
	            "@type": "WebSite",
	            "@id": "https://localhost/rustvietnam/#website",
	            "url": "https://localhost/rustvietnam/",
	            "name": "RustVietnam",
	            "description": "Trang Web d\u00e0nh cho nh\u1eefng ng\u01b0\u1eddi b\u1ea1n y\u00eau th\u00edch ng\u00f4n ng\u1eef l\u1eadp tr\u00ecnh Rust. Ch\u00fang t\u00f4i kh\u00f4ng \u0111\u1ea1i di\u1ec7n hay c\u00f3 li\u00ean h\u1ec7 g\u00ec v\u1edbi team ch\u00ednh th\u1ee9c c\u1ee7a Rust ( rust-lang.org )",
	            "potentialAction": [
	                {
	                    "@type": "SearchAction",
	                    "target": {
	                        "@type": "EntryPoint",
	                        "urlTemplate": "https://localhost/rustvietnam/?s={search_term_string}"
	                    },
	                    "query-input": "required name=search_term_string"
	                }
	            ],
	            "inLanguage": "en-US"
	        },
	        {
	            "@type": "WebPage",
	            "@id": "https://rustvietnam.com/lap-trinh-web-voi-rust/quan-li-sessions/#webpage",
	            "url": "https://rustvietnam.com/lap-trinh-web-voi-rust/quan-li-sessions/",
	            "name": "Qu\u1ea3n l\u00fd Sessions - RustVietnam",
	            "isPartOf": {
	                "@id": "https://localhost/rustvietnam/#website"
	            },
	            "datePublished": "2021-09-27T07:31:30+00:00",
	            "dateModified": "2021-12-05T15:12:22+00:00",
	            "author": {
	                "@id": "https://localhost/rustvietnam/#/schema/person/e0d03b8f89a39fe8d8a990c7d2d9c655"
	            },
	            "breadcrumb": {
	                "@id": "https://rustvietnam.com/lap-trinh-web-voi-rust/quan-li-sessions/#breadcrumb"
	            },
	            "inLanguage": "en-US",
	            "potentialAction": [
	                {
	                    "@type": "ReadAction",
	                    "target": [
	                        "https://rustvietnam.com/lap-trinh-web-voi-rust/quan-li-sessions/"
	                    ]
	                }
	            ]
	        },
	        {
	            "@type": "BreadcrumbList",
	            "@id": "https://rustvietnam.com/lap-trinh-web-voi-rust/quan-li-sessions/#breadcrumb",
	            "itemListElement": [
	                {
	                    "@type": "ListItem",
	                    "position": 1,
	                    "name": "Home",
	                    "item": "https://localhost/rustvietnam/"
	                },
	                {
	                    "@type": "ListItem",
	                    "position": 2,
	                    "name": "Qu\u1ea3n l\u00fd Sessions"
	                }
	            ]
	        },
	        {
	            "@type": "Person",
	            "@id": "https://localhost/rustvietnam/#/schema/person/e0d03b8f89a39fe8d8a990c7d2d9c655",
	            "name": "admin",
	            "image": {
	                "@type": "ImageObject",
	                "@id": "https://localhost/rustvietnam/#personlogo",
	                "inLanguage": "en-US",
	                "url": "http://0.gravatar.com/avatar/f85eb7eaabe6640d9c988c04988fbaf0?s=96&d=mm&r=g",
	                "contentUrl": "http://0.gravatar.com/avatar/f85eb7eaabe6640d9c988c04988fbaf0?s=96&d=mm&r=g",
	                "caption": "admin"
	            },
	            "sameAs": [
	                "https://rustvietnam.com"
	            ],
	            "url": "https://rustvietnam.com/author/admin/"
	        }
	    ]
	}</script> <link rel='dns-prefetch' href='//s.w.org' /><link rel="alternate" type="application/rss+xml" title="RustVietnam &raquo; Quản lý Sessions Comments Feed" href="https://rustvietnam.com/lap-trinh-web-voi-rust/quan-li-sessions/feed/" /><style id='md-style-inline-css' type='text/css'></style><link rel="https://api.w.org/" href="https://rustvietnam.com/wp-json/" /><link rel="alternate" type="application/json" href="https://rustvietnam.com/wp-json/wp/v2/posts/398" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://rustvietnam.com/xmlrpc.php?rsd" /><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://rustvietnam.com/wp-includes/wlwmanifest.xml" /><meta name="generator" content="WordPress 5.8.2" /><link rel='shortlink' href='https://rustvietnam.com/?p=398' /><link rel="alternate" type="application/json+oembed" href="https://rustvietnam.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Flocalhost%2Frustvietnam%2Flap-trinh-web-voi-rust%2Fquan-li-sessions%2F" /><link rel="alternate" type="text/xml+oembed" href="https://rustvietnam.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Flocalhost%2Frustvietnam%2Flap-trinh-web-voi-rust%2Fquan-li-sessions%2F&#038;format=xml" /><link theme media="all" href="https://rustvietnam.com/wp-content/themes/onda/media/media_style.css" rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://rustvietnam.com/wp-content/themes/onda/media/media_style.js" type="text/javascript"></script>  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RZCKSNE480"></script> <script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-RZCKSNE480');</script> </head><body><div id="site_init_loading" style="position: fixed;
width: 100%;
height: 100%;
background-color: #ffffff;
z-index: 999;
text-align: center;
display: flex;
justify-content: center;
align-items: center;"> <img src="https://rustvietnam.com/wp-content/themes/onda/images/loading.gif"/></div><nav id="navbar-main" class="navbar navbar-main navbar-expand-lg bg-white navbar-light position-sticky top-0 shadow py-2"><div class="container"> <a class="navbar-brand mr-lg-5" href="https://rustvietnam.com"> <img src="https://rustvietnam.com/wp-content/themes/onda/images/logo.svg" width="60"/> <span>RustVietnam</span> </a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar_global" aria-controls="navbar_global" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button><div class="navbar-collapse collapse" id="navbar_global"><div class="navbar-collapse-header"><div class="row"><div class="col-6 collapse-brand"> <a href="https://rustvietnam.com"> <img src="https://rustvietnam.com/wp-content/themes/onda/images/logo.svg" width="60"/> </a></div><div class="col-6 collapse-close"> <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar_global" aria-controls="navbar_global" aria-expanded="false" aria-label="Toggle navigation"> <span></span> <span></span> </button></div></div></div><ul class="navbar-nav navbar-nav-hover align-items-lg-center"><li class="nav-item dropdown"> <a class="nav-link" data-toggle="dropdown" role="button"> <i class="ni ni-ui-04 d-lg-none"></i> <span class="nav-link-inner--text">Nền tảng</span> </a><div class="dropdown-menu dropdown-menu-xl"><div class="dropdown-menu-inner"> <a href="https://rustvietnam.com/lap-trinh-co-ban-rust/cai-dat-rust/" class="media d-flex align-items-center"><div class="icon icon-shape bg-gradient-primary rounded-circle text-white"> <i class="ni ni-spaceship"></i></div><div class="media-body ml-3"><h6 class="heading text-primary mb-md-1">Bắt đầu</h6><p class="description d-none d-md-inline-block mb-0">Cài đặt Rust</p></div> </a> <a href="https://rustvietnam.com/chuong-trinh/lap-trinh-co-ban-rust/" class="media d-flex align-items-center"><div class="icon icon-shape bg-gradient-success rounded-circle text-white"> <i class="ni ni-palette"></i></div><div class="media-body ml-3"><h6 class="heading text-primary mb-md-1">Lập trình cơ bản</h6><p class="description d-none d-md-inline-block mb-0">Các hướng dẫn cơ bản/cốt lõi nhất để có thể bắt đầu với Rust</p></div> </a> <a href="https://rustvietnam.com/chuong-trinh/thu-vien-chuan/" class="media d-flex align-items-center"><div class="icon icon-shape bg-gradient-warning rounded-circle text-white"> <i class="ni ni-ui-04"></i></div><div class="media-body ml-3"><h5 class="heading text-warning mb-md-1">Thư viện chuẩn</h5><p class="description d-none d-md-inline-block mb-0">Các thư viện có sẵn vô cùng mạnh mẽ, phù hợp với tất cả các yêu cầu</p></div></a></div></div></li><li class="nav-item dropdown"> <a class="nav-link" data-toggle="dropdown" role="button"> <i class="ni ni-collection d-lg-none"></i> <span class="nav-link-inner--text">Nâng cao</span> </a><div class="dropdown-menu"> <a href="https://rustvietnam.com/chuong-trinh/lap-trinh-ham/" class="dropdown-item">Lâp trình hàm</a> <a href="https://rust-unofficial.github.io/patterns/" target="_blank" class="dropdown-item">Lập trình hướng đối tượng</a> <a target="_blank" href="https://drive.google.com/file/d/1pz15PPdWCVk1JI-1xfhK6CjPWR7NWj_I/view?usp=sharing" class="dropdown-item">Lập trình hệ thống</a> <a href="https://drive.google.com/file/d/1g6ZLNWUqBU1tBICRmLlr-rXqaUBRcDgB/view?usp=sharing" target="_blank" class="dropdown-item">Cấu trúc dữ liệu/thuật toán</a></div></li></ul><ul class="navbar-nav navbar-nav-hover align-items-lg-center"><li class="nav-item dropdown"> <a class="nav-link" data-toggle="dropdown" role="button"> <i class="ni ni-collection d-lg-none"></i> <span class="nav-link-inner--text">Network</span> </a><div class="dropdown-menu"> <a href="https://rustvietnam.com/chuong-trinh/lap-trinh-web-voi-rust/" class="dropdown-item">Lập trình Web</a> <a href="https://rustvietnam.com/chuong-trinh/webassembly/" class="dropdown-item">WebAssembly</a></div></li><li> <a href="https://rustvietnam.com/chuong-trinh/lap-trinh-nhung" class="nav-link" > Lập trình nhúng </a></li><li> <a target="_blank" rel="nofollow" href="https://substrate.dev/en/tutorials" class="nav-link" > BlockChain </a></li></ul><ul class="navbar-nav align-items-lg-center ml-lg-auto"><li class="nav-item d-none d-lg-block"> <a href="https://rustvietnam.com/gioi-thieu/" class="btn btn-primary btn-icon"> <span class="nav-link-inner--text">Giới thiệu</span> </a></li></ul></div></div></nav><div class="section section-hero section-shaped"><div class="shape shape-style-1 shape-primary"> <span class="span-150"></span> <span class="span-50"></span> <span class="span-50"></span> <span class="span-75"></span> <span class="span-100"></span> <span class="span-75"></span> <span class="span-50"></span> <span class="span-100"></span> <span class="span-50"></span> <span class="span-100"></span></div><div class="page-header"><div class="container shape-container d-flex align-items-center py-lg"><div class="col px-0"><div class="row align-items-center justify-content-center"><div class="col-lg-8 text-center text-white"><h1 class="display-2 text-white">Quản lý Sessions</h1><p class="lead"><p>Session là thông tin về phiên làm việc cho từng khách truy cập</p></p></div></div></div></div></div><div class="separator separator-bottom separator-skew zindex-100"> <svg x="0" y="0" viewBox="0 0 2560 100" preserveAspectRatio="none" version="1.1" xmlns="http://www.w3.org/2000/svg"> <polygon class="fill-white" points="2560 0 2560 100 0 100"></polygon> </svg></div></div><section class="section"><div class="container"><div class="row justify-content-center flex-row-reverse"><div class="col-lg-4 single-sidebar"><h2><a class="text-danger" href="https://rustvietnam.com/chuong-trinh/lap-trinh-web-voi-rust/">Lập trình Web với Rust</a></h2><ul class="catlist" style="padding-left: 17px;"><li><a href="https://rustvietnam.com/lap-trinh-web-voi-rust/chuong-1-huong-dan-co-ban-ve-lap-trinh-voi-rust/">Chương 1 - Hướng dẫn cơ bản về lập trình với Rust</a></li><li><a href="https://rustvietnam.com/lap-trinh-web-voi-rust/chuong-2-thiet-ke-mot-web-app-voi-rust/">Chương 2 - Thiết kế một Web App với Rust</a></li><li><a href="https://rustvietnam.com/lap-trinh-web-voi-rust/chuong-3-xu-li-http-requests-voi-actix-web-framework/">Chương 3 - Xử lí HTTP Requests với Actix Web framework</a></li><li><a href="https://rustvietnam.com/lap-trinh-web-voi-rust/chuong-4-xu-li-du-lieu-http-requests-voi-actix-web-framework/">Chương 4  - Xử lí Dữ liệu HTTP Requests với Actix Web framework</a></li><li><a href="https://rustvietnam.com/lap-trinh-web-voi-rust/hien-thi-trang-web-tren-trinh-duyet/">Chương 5 - Hiển thị trang Web trên trình duyệt</a></li><li><a href="https://rustvietnam.com/lap-trinh-web-voi-rust/co-so-du-lieu-postgresql/">Chương 6 - Cơ sở dữ liệu PostgreSQL</a></li><li><a href="https://rustvietnam.com/lap-trinh-web-voi-rust/quan-li-sessions/">Chương 7 - Quản lý Sessions</a></li></ul></div><div class="col-lg-8 single-content"><p>Ở các chương trước,phần đăng nhập user vẫn để ngỏ với 1 token đơn giản, để quản lý user chúng ta cần tìm hiểu Sessions trong Rust.Session là thông tin về phiên làm việc cho từng khách truy cập.<br /> Ví dụ nếu người dùng đã đăng nhập, thì thông tin đăng nhập được lưu lại và chuyển cho các trang khác nhau trong phiên làm việc để tránh mỗi lần gửi request lại phải đăng nhập, hay người dùng chọn đựa mặt hàng vào giỏ hàng thì phải nhớ để chuyển đến trang thanh toán ...<br /> Trong chương này ta sẽ làm một số việc như sau</p><ol><li>Tạo table cho user trong database</li><li>Kiểm tra password và JSON Web Tokens (JWTs)</li><li>Login và Logout</li><li>Lưu credentials và sử dụng cho mỗi API call</li><li>Quản lý user session</li></ol><p>Bắt đầu thôi</p><h2>Tạo user data model</h2><p>Chúng ta thêm vào Cargo.toml</p><blockquote><p>[dependencies]<br /> bcrypt = &quot;0.8.2&quot;<br /> uuid = {version = &quot;0.8&quot;, features = [&quot;serde&quot;, &quot;v4&quot;]}</p></blockquote><p>crate <strong>bcrypt</strong> tạo hash và kiểm tra password, crate <strong>uuid</strong> tạo unique ID cho user.</p><blockquote><p>diesel migration generate create_users</p></blockquote><p>Trong <strong>up.sql</strong> ta tạo table users và 1 account admin mặc định cho bạn</p><pre><code class="language-html">-- Your SQL goes here
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR NOT NULL,
  email VARCHAR NOT NULL,
  password VARCHAR NOT NULL,
  unique_id VARCHAR NOT NULL,
  UNIQUE (email),
  UNIQUE (name)
);

-- create a master user
INSERT INTO users (name, email, password, unique_id)
VALUES (&#039;admin&#039;, &#039;hocrust@gmail.com&#039;,
&#039;123456&#039;, &#039;1&#039;);

-- update the to do table
ALTER TABLE to_do ADD user_id integer default 1
CONSTRAINT user_id REFERENCES users NOT NULL;</code></pre><p>Trong file down.sql</p><pre><code class="language-html">-- This file should undo anything in `up.sql`
ALTER TABLE to_do DROP COLUMN user_id;

-- drop the users table
DROP TABLE users</code></pre><p>Đã xong thì ta chạy</p><blockquote><p>diesel migration run</p></blockquote><p>Vậy là đã thêm table xong , giờ trong <strong>src/models</strong> ta thêm vô user</p><pre><code class="language-html">└── user
    ├── mod.rs
    ├── new_user.rs
    └── user.rs</code></pre><p>File new_user.rs tương tự như new_item.rs, ta khai báo struct cho NewUser.</p><pre><code class="language-html">extern crate bcrypt;
use uuid::Uuid;
use diesel::Insertable;
use bcrypt::{DEFAULT_COST, hash};
use crate::schema::users;
#[derive(Insertable, Clone)]
#[table_name=&quot;users&quot;]
pub struct NewUser {
    pub username: String,
    pub email: String,
    pub password: String,
    pub unique_id: String,
}</code></pre><p>Ở đây chúng ta cho phép NewUser là Insertable (có thể thêm vào được) nhưng không cho queried, chúng ta muốn rằng nếu có code lấy dữ liệu user từ database thì chỉ thấy được ID thôi , ko có thông tin khác. Ngoài ra để đảm bảo tính bảo mật chúng ta còn mã hóa (hash) password rồi mới lưu vào database , password đã hash thì không đảo ngược lại được nên nếu mình có quên pass thì chỉ có thể reset password.</p><pre><code class="language-html">impl NewUser {
    pub fn new(username: String, email: String, password: String) -&gt; NewUser {
        let hashed_password: String = hash(password.as_str(),DEFAULT_COST).unwrap();
        let uuid = Uuid::new_v4().to_string();
        return NewUser {username, email, password:hashed_password,unique_id: uuid}
    }
}</code></pre><p>Đoạn code trên ta dùng hàm <strong>hash</strong> từ crate <strong>bcrypt</strong> để mã hóa password và trả kết quả lại</p><hr/><div class="powr-comments" id="e67d472b_398"></div><script src="https://www.powr.io/powr.js?platform=html"></script> </div></div></div></section><footer class="footer has-cards"><div class="container"><hr><div class="row align-items-center justify-content-md-between"><div class="col-md-6"><div class="copyright"> © 2021 <a href="" target="_blank">Bản quyền thuộc về RustVietNam</a>.</div></div><div class="col-md-6 text-right"> <a style="font-size: 14px;" class="text-teal" href="https://rustvietnam.com/privacy-policy">Điều khoản</a></div></div></div></footer></body></html>